<h1>Device Details</h1>

<script>
var device = "Monitor" // (new URL(window.location.href)).searchParams.get("device")

var pageTitle = document.getElementById("page-title")
pageTitle.textContent = device + ': Details'


$hk.itemsToReload.push({
    filename: "logs/Errorlog",
    responseType: 'text',
    completionHandler: function () {
        const log = document.querySelector("#log-1")
        log.querySelector("h4").textContent = this.responseURL.split('/').pop().split('?')[0]
        log.querySelector("pre").textContent = this.response
    }
})

$hk.itemsToReload.push({
    filename: "cgi-bin/pg-query.py?q=overview",
    responseType: 'text',
    completionHandler: function () {
        const log = document.querySelector("#log-2")
        log.querySelector("h4").textContent = this.responseURL.split('/').pop() //.split('?')[0]
        log.querySelector("pre").textContent = this.response
    }
})

$hk.itemsToReload.push({
    filename: "cgi-bin/pg-query.py?q=details&device=Monitor&time=" + document.getElementById("time-range-selector").value,
    // filename: "json/pg-query_details.json", // for offline testing
    responseType: 'json',
    completionHandler: function () {
        $hk.plot.update("history-cpu", "CPUidle ", {"title": "CPU Usage [%]", "min": -1, "max": 101}, this.response)
        $hk.plot.update("history-temperature", "Temp", {"title": "Temperature [℃]", "min": 15, "max": 60}, this.response)
    }
})
</script>

<div id="current-status" class="box">
    <div class="title">
        <div style="float: right;">
            <label for="time-range-selector">Show time range:</label>
            <select name="time-range-selector" id="time-range-selector">
                <!-- Values in hours. TODO: Implement this! -->
                <option value="0.5" selected>Last 30 minutes</option>
                <option value="2">Last 2 hours</option>
                <option value="8">Last 8 hours</option>
                <option value="24">Last day</option>
                <option value="168">Last week</option>
            </select>
        </div>
        <h2>Current status (Last updated: <time datetime="2020-10-30T02:35:47+0800">30 Oct 2020, 02:35:47</time>)</h2>
    </div>

    <!-- TODO: This is just a static mockup currently. Fill in all properties (and their current value) of the device with JS.
        Use `determineStatusIndicatorColour(device, ranges)` for formatting. -->
    <div style="column-count: 3;">
        <p>IP: <span class="ok">192.168.53.231</span></p>
        <p>Last update: <span class="ok">02:35:47</span></p>
        <p>Uptime: 20 d, 8 h, 18 min</p>
        <p>Temperature: <span class="warning">67°C</span></p>
        <p>CPU: <span class="warning">96%</span></p>
        <p>RAM: <span class="ok">71%</span></p>
        <p>NIC: <span class="ok">70%</span></p>
        <p>Free disk space: <span class="ok">4.8 TB</span> (HDD) / <span class="ok">1.4 TB</span> (SSD)</p>
    </div>
</div>

<div class="plot-div" id="history-cpu"></div>
<div class="plot-div" id="history-temperature"></div>

<div class="log" id="log-1">
    <h4 class="title">Filename.txt</h4>
    <pre>[Content from some log file goes here]</pre>
</div>
<div class="log" id="log-2">
    <h4 class="title">Filename.txt</h4>
    <pre>[Content from some log file goes here]</pre>
</div>
